$(function() {
	if(isBrowser().ie < 9) {
	    adjustStyle($(this).width());
	    $(window).resize(function() {
	        adjustStyle($(this).width());
	    });
	}
	
	getCookieSkin();//获取cook中的皮肤
});

function adjustStyle(width){
	width = parseInt(width);
	//if (width >= 1200) {alert(">=1200")} else if(width>=992 && width<=1199){alert("<=1199")}else if(width>=768 && width<=991){alert("<=991")}else{alert("<=767")}
	if (width >= 1200) {reload("w1200");} else if(width>=992 && width<=1199){reload("w992");}else if(width>=768 && width<=991){reload("w768");}else{reload("w767");}
	//alert($('body').attr("class"));
}
function reload(cssName){
	if ($('body').hasClass("w1200") && cssName != "w1200"){
		$('body').removeClass("w1200");
	}
	if ($('body').hasClass("w992") && cssName != "w992"){
		$('body').removeClass("w992");
	}
	if ($('body').hasClass("w768") && cssName != "w768"){
		$('body').removeClass("w768");
	}
	if ($('body').hasClass("w767") && cssName != "w767"){
		$('body').removeClass("w767");
	}
	if (!$('body').hasClass(cssName)) {
		$('body').addClass(cssName);
	}
}


/** js中的Array添加定位/删除属性 **/
Array.prototype.indexOf = function(val) {
	for (var i = 0; i < this.length; i++) {
		if (this[i] == val) return i;
	}
	return -1;
};

Array.prototype.remove = function(val) {
	var index = this.indexOf(val);
	if (index > -1) {
		this.splice(index, 1);
	}
};

/** 获取网址路径 **/
function getPath(){
	var pathname = '/'+window.location.pathname.split('/')[1]+'/';
	var path = window.location.href.split(pathname)[0] + pathname;
	return path;
}

/** 判断浏览器 **/
function isBrowser() {
    var Sys = {};
    var ua=navigator.userAgent.toLowerCase();
    var s;
    (s=ua.match(/msie\s([\d.]+)/))?Sys.ie=s[1]:
    (s=ua.match(/trident.*rv:([\d.]+)/))?Sys.ie=s[1]:
    (s=ua.match(/firefox\/([\d.]+)/))?Sys.firefox=s[1]:
    (s=ua.match(/chrome\/([\d.]+)/))?Sys.chrome=s[1]:
    (s=ua.match(/opera.([\d.]+)/))?Sys.opera=s[1]:
    (s=ua.match(/version\/([\d.]+).*safari/))?Sys.safari=s[1]:0;
    //alert(JSON.stringify(Sys));
    return Sys;
/*	if(isBrowser().ie){//Js判断为IE浏览器
		alert(isBrowser().ie + " IE_have");
		if(isBrowser().ie=='9.0'){//Js判断为IE 9
			alert(isBrowser().ie + " IE_9.0");
		}else if(isBrowser().ie=='8.0'){//Js判断为IE 8
			alert(isBrowser().ie + " IE_8.0");
		}else{
			alert(isBrowser().ie + " IE_other");
		}
	}
	if(isBrowser().firefox){//Js判断为火狐(firefox)浏览器
		alert(isBrowser().firefox + " firefox");
	}
	if(isBrowser().chrome){//Js判断为谷歌chrome浏览器
		alert(isBrowser().chrome + " chrome");
	}
	if(isBrowser().opera){//Js判断为opera浏览器
		alert(isBrowser().opera + " opera");
	}
	if(isBrowser().safari){//Js判断为苹果safari浏览器
		alert(isBrowser().safari + " safari");
	}*/
}

function fBrowserRedirect(){
	var sUserAgent=navigator.userAgent.toLowerCase();
	var bIsIpad=sUserAgent.match(/ipad/i)=="ipad";
	var bIsIphoneOs=sUserAgent.match(/iphone os/i)=="iphone os";
	var bIsMidp=sUserAgent.match(/midp/i)=="midp";
	var bIsUc7=sUserAgent.match(/rv:1.2.3.4/i)=="rv:1.2.3.4";
	var bIsUc=sUserAgent.match(/ucweb/i)=="ucweb";
	var bIsAndroid=sUserAgent.match(/android/i)=="android";
	var bIsCE=sUserAgent.match(/windows ce/i)=="windows ce";
	var bIsWM=sUserAgent.match(/windows mobile/i)=="windows mobile";
	if (bIsIpad||bIsIphoneOs||bIsAndroid||bIsMidp||bIsUc7||bIsUc||bIsCE||bIsWM) {
		return true;
	}
	return false;
}

/** 字符串截取显示 **/
function showNewStr(str,newstrlength) {
	if (str.length > 0) {
		var syslength = 0;
		var newstr = '';
		
		if (newstrlength > 0) {
			for (var i = 0; i < str.length; i++) {
				if (str.charCodeAt(i) > 255) {
					syslength += 2;
				} else {
					syslength++;
				}
				
				if (syslength > newstrlength) {
					if (syslength == newstrlength) {
						return newstr;
					} else {
						return newstr + '...';
					}
				}
				newstr += str.charAt(i);
			}
			return newstr.replace("\"", "\''").replace("\r", "").replace("\n", "");
		} else {
			return str.replace("\"", "\''").replace("\r", "").replace("\n", "");
		}
	} else {
		return str.replace("\"", "\''").replace("\r", "").replace("\n", "");
	}
}

/** 操作面板展开隐藏 **/
function moreHidden(obj) {
	if ($(obj).hasClass("base_more-openicon")) {
		$(obj).removeClass("base_more-openicon");
		$(obj).addClass("base_more-closeicon");
	} else {
		$(obj).removeClass("base_more-closeicon");
		$(obj).addClass("base_more-openicon");
	}
	$("#moreHiddenArea").slideToggle();
}

/** 获取cook中的模板 **/
function getCookieTemplate() {
	var templateName = typeof($.cookie('templateName')) != "undefined" ?  $.cookie('templateName') : "fixed";
	$('body').addClass(templateName);
}

/** 获取cook中的皮肤 **/
function getCookieSkin() {
	var skinName = typeof($.cookie('skinName')) != "undefined" ?  $.cookie('skinName').split(',') : ["skin-blue base_skin-aqua","base_box-area-aqua","modal-aqua"];
	var skinNameOld = typeof($.cookie('skinNameOld')) != "undefined" ? $.cookie('skinNameOld').split(',') : ["skin-blue base_skin-aqua","base_box-area-aqua","modal-aqua"];
	var bodySkin = skinName[0],boxSkin = skinName[1],dialogSkin = skinName[2];
	var bodySkinOld = skinNameOld[0],boxSkinOld = skinNameOld[1],dialogSkinOld = skinNameOld[2];
	
	$('body').removeClass(bodySkinOld);
	$('body').addClass(bodySkin);
	if ($("div[name='boxSkin']").length > 0) {
		$("div[name='boxSkin']").removeClass(boxSkinOld);
		$("div[name='boxSkin']").addClass(boxSkin);
	}
	if ($(".ui-dialog").length > 0) {
		$(".ui-dialog").removeClass(dialogSkinOld);
		$(".ui-dialog").addClass(dialogSkin);
	}
	
	if ($("#mainFrame").length > 0) {
		$(window.frames["mainFrame"].document).find("body").removeClass(bodySkinOld);
		$(window.frames["mainFrame"].document).find("body").addClass(bodySkin);
		if ($(window.frames["mainFrame"].document).find("div[name='boxSkin']").length > 0) {
			$(window.frames["mainFrame"].document).find("div[name='boxSkin']").removeClass(boxSkinOld);
			$(window.frames["mainFrame"].document).find("div[name='boxSkin']").addClass(boxSkin);
		}
		if ($(window.frames["mainFrame"].document).find(".ui-dialog").length > 0) {
			$(window.frames["mainFrame"].document).find(".ui-dialog").removeClass(dialogSkinOld);
			$(window.frames["mainFrame"].document).find(".ui-dialog").addClass(dialogSkin);
		}
	}
}

/**
 * 服务器验证,async:false同步执行
 * 验证通过：true
 * 不通过：false **/
function serversValidator(url,dataParam) {
	var resultBoolean = false;
	$.ajax({
		type : 'post',
		url : url,
		dataType : 'json',
		cache : false,
		async : false,
		traditional : true,
		data : dataParam,
		error : function(request, textStatus, errorThrown) {
			resultBoolean = false;
		},
		success : function(data) {
			resultBoolean = data.valid;
		}
	});
	return resultBoolean;
}
/**
 * 监听表格及渲染ICheck控件
 * tableId 
 * author smj
 */
function drawICheck(tableId){
	//iCheck美化
	$('input').iCheck({
		checkboxClass: 'icheckbox_square-blue',
		radioClass: 'iradio_square-blue',
		increaseArea: '20%' // optional
	});
	
	$('input[type=radio]').on('ifChecked',function(event){
		$(this).attr("checked", true);
	});
	$('input[type=radio]').on('ifUnchecked',function(event){
		$(this).attr("checked", false);
	});
	$('input[type=checkbox]').on('ifChecked',function(event){
		$(this).attr("checked", true);
	});
	$('input[type=checkbox]').on('ifUnchecked',function(event){
		$(this).attr("checked", false);
	});
	
	//iCheck绑定事件,操作bootstrapTable点击行事件
	if ($('#'+tableId).length > 0 && $('#'+tableId+' input[type=radio]').length > 0) {
		$('#'+tableId+' input[type=radio]').on('ifChecked',function(event){
			$(this).closest("tr").addClass("selected");
			$(this).attr("checked", true);
			var dataIndex = $(this).attr("data-index");
			$("#"+tableId).bootstrapTable("check",dataIndex);
		});
		$('#'+tableId+' input[type=radio]').on('ifUnchecked',function(event){
			$(this).closest("tr").removeClass("selected");
			$(this).attr("checked", false);
			$("#"+tableId).bootstrapTable("uncheckAll");
		});
	}
	//iCheck绑定事件,操作bootstrapTable点击行事件
	if ($('#'+tableId).length > 0 && $('#'+tableId+' input[type=checkbox]').length > 0) {
		$('#'+tableId+' input[type=checkbox]').on('ifChecked',function(event){
			$(this).closest("tr").addClass("selected");
			$(this).attr("checked", true);
			var dataIndex = $(this).attr("data-index");
			$("#"+tableId).bootstrapTable("check",dataIndex);
		});
		$('#'+tableId+' input[type=checkbox]').on('ifUnchecked',function(event){
			$(this).closest("tr").removeClass("selected");
			$(this).attr("checked", false);
			$("#"+tableId).bootstrapTable("uncheckAll");
		});
	}
}

/** 操作模糊查询按钮事件 **/
function mhcxCk() {
	$('#mhcx').on('ifChecked',function(event){
		if ($("#searchBtn").length > 0) {
			$("#searchBtn").text("模糊搜索");
		}
	});
	$('#mhcx').on('ifUnchecked',function(event){
		if ($("#searchBtn").length > 0) {
			$("#searchBtn").text("搜索");
		}
	});
	//赋予提示
	$("#mhcx").next("ins").attr("title",$("#mhcx").attr("title"));
}

/** 获取内容页面宽高参数,iframe内部页面调取该方法 **/
function returnInnerPage(parm) {
	var w = $(window.top.document).find(".wrapper").width();
	var navigationW = $(window.top.document).find(".navigationSidebar").width();
	var contentW = $(window.top.document).find(".base_iframe-content-wrapper").width();
	if (w > contentW) {
		w = w - navigationW;
	}
	var h = $(window.top).height();
	var fillSpaseH = $(window.top.document).find(".base_fill-space").height();
	h = h - fillSpaseH;
	
	if ("width" == parm) {
		return w;
	} else if ("height" == parm) {
		return h;
	} else {
		return {"width":w,"height":h};
	}
}

/** 设置内容页面宽和高,与mCustomScrollbar滚动条配合,iframe内部页面调取该方法 **/
function setInnerPage() {
	if (fBrowserRedirect()) {
		var returnInnerPage = this.returnInnerPage();
		var w = returnInnerPage.width;
		var h = returnInnerPage.height;
		$("body").width(w).height(h);
	}
	//if (!isBrowser().ie) {
		var h = this.returnInnerPage("height");
		$("body").mCustomScrollbar({theme:"minimal-dark",scrollInertia:20,axis:"y",set_height:h});
	//}
	if (fBrowserRedirect()) {
		window.addEventListener("orientationchange", function() {
			//监听方向改变时调取
			var returnInnerPage = this.returnInnerPage();
			var w = returnInnerPage.width;
			var h = returnInnerPage.height;
			$("body").width(w).height(h);
			
			if ($(getNowDialog()).find("label").hasClass("text-right")) {
				$(getNowDialog()).find("label").removeClass("text-right");
			}
			$(getNowDialog()).find("label").addClass("text-left");
			
		}, false);
	}
	$(window).resize(function() {
		//监听窗口大小改变时调取
		var returnInnerPage = this.returnInnerPage();
		var w = returnInnerPage.width;
		var h = returnInnerPage.height;
		$("body").width(w).height(h);
	});
}

/** 设置首页面菜单栏高,与mCustomScrollbar滚动条配合,首页面调取该方法 **/
function setHomePage() {
	var h = this.returnInnerPage("height");
	$(".base_iframe-content-wrapper").css({"min-height":h+"px"});
	$(".sidebar").mCustomScrollbar({theme:"minimal-dark",scrollInertia:20,axis:"y",set_height:"100%"});
	if (fBrowserRedirect()) {
		window.addEventListener("orientationchange", function() {
			//监听方向改变时调取
			var returnInnerPage = this.returnInnerPage();
			var h = returnInnerPage.height;
			$(".base_iframe-content-wrapper").css({"min-height":h+"px"});
		}, false);
	}
	$(window).resize(function() {
		var returnInnerPage = this.returnInnerPage();
		var h = returnInnerPage.height;
		$(".base_iframe-content-wrapper").css({"min-height":h+"px"});
	});
}

/** 清空区域(如果class="notClear"不清空) **/
function clearRegion(region) {
	$(region).find("input[type!='submit'][type!='reset'][type!='button'],textarea,select").each(function() {
		if (!$(this).hasClass("notClear")) {
			if ($(this).is(":radio") || $(this).is(":checkbox")) {
				$(this).removeAttr("checked");
				if ($(this).next("ins").length > 0) {
					//drawICheck();//监听渲染ICheck控件
				}
			} else {
				$(this).val("");
				if ($(this).is("select") && $(this).is(":hidden") && $(this).next("div .chosen-container").length > 0) {
					selectUpdated($(this));
				}
			}
		}
	});
}

/** 设置区域锁定(如果class="notLock"不锁定) **/
function setRegionLock(region) {
	if (!$(region).hasClass("base_not-allowed")) {
		$(region).addClass("base_not-allowed");
	}
	$(region).find("input,textarea,select").each(function() {
		if (!$(this).hasClass("notLock")) {
			$(this).attr("disabled","disabled").attr("readonly","readonly");
		}
		if ($(this).is("select") && $(this).is(":hidden") && $(this).next("div .chosen-container").length > 0) {
			selectUpdated($(this));
		}
	});
}
/** 设置区域解锁 **/
function setRegionNotLock(region) {
	if ($(region).hasClass("base_not-allowed")) {
		$(region).removeClass("base_not-allowed");
	}
	$(region).find("input,textarea,select").each(function() {
		$(this).removeAttr("disabled").removeAttr("readonly");
		if ($(this).is("select") && $(this).is(":hidden") && $(this).next("div .chosen-container").length > 0) {
			selectUpdated($(this));
		}
	});
}

/** 改变表单元素为块级元素 **/
function changeFormToDiv(region) {
	$(region).find("input[type!='submit'][type!='reset'][type!='button'][type!='hidden'],textarea,select").each(function(){
		//先操作创建的元素DIV去除以及元素显示
		if ($(this).next("div[formType]").length > 0) {
			$(this).next("div[formType]").remove();
			$(this).show();
		}
		if ($(this).is(':visible') && ($(this).is(":text") || $(this).is(":password") || $(this).is("textarea") || $(this).is("select"))) {
			$(this).hide();
			$(this).siblings().hide();
			var divInnerHTML = "";
			if ($(this).is("select")) {
				divInnerHTML = $(this).find("option:selected").text();
			} else if ($(this).is("textarea")) {
				divInnerHTML = $(this).val();
				divInnerHTML = ((divInnerHTML.replace(/<(.+?)>/gi,"&lt;$1&gt;")).replace(/ /gi,"&nbsp;")).replace(/\n/gi,"<br/>");
			} else {
				divInnerHTML = $(this).val();
			}
			$(this).after("<div class='base_white-space-normal base_line-height-noraml' formType>" + divInnerHTML + "</div>");
		} else if ($(this).is(":hidden") && $(this).is("select") && $(this).next("div .chosen-container").length > 0) {
			$(this).next("div .chosen-container").hide();
			var divInnerHTML = $(this).find("option:selected").text();
			$(this).after("<div class='base_white-space-normal base_line-height-noraml' formType>" + divInnerHTML + "</div>");
		}
	});
}
/** 改变块级元素为表单元素 **/
function changeDivToForm(region) {
	$(region).find("div[formType]").each(function(){
		if ($(this).siblings("select").length > 0 && $(this).siblings("div.chosen-container").length > 0) {
			$(this).siblings("div.chosen-container").show();
		} else {
			$(this).siblings().show();
		}
		$(this).remove();
	});
}

/** 加载标题信息*/
function loadInfoText(){
	 var depart = "";
	 var items =  "";
	 var userName = "";
	 if(window.opener == null){
		 $.ajax({
				type : 'post',
				url : '../../tempInfoAction!findCurrentUserDepartMent.action', 
				dataType : 'json',
				cache : false,
				async : false,
				error : function(request, textStatus, errorThrown) {
					//fxShowAjaxError(request, textStatus, errorThrown);
				},
				success : function(data) {
					/* searchTxt = "应 "+data.depart+" 单位 "; */
					depart = "应 "+data.depart+" ";
					items = data.items;
					userName = data.userName;
				}
			});
	 }else{
		 depart = window.opener.searchTxt;
		 items =  window.opener._items;
		 userName = window.opener.useName;
	 }
	 var selectControl = "<select id=\"selectItems\">";
	 var defaultText = "";
	 $(items).each(function(i,item){
		 if(i == 0){
			 defaultText = item.name;
		 }
		 selectControl += "<option value=\""+item.id+"\">"+item.name+"</option>";
	 });
	 selectControl += "</select>";
	 /*$("#topText").html(depart+"  "+userName+" 人员办理  "+selectControl+" 事项请求,经查询,结果如下:");*/
	 $("#topText").html(depart+"  "+userName+" 办理  "+selectControl+" 事项请求,结果如下:");
	 $("#selectItems").change(function(){
		 $("#shixiang").html($(this).children('option:selected').html());
	 });
	 $("#shixiang").html(defaultText);
}

function generatePDF(){
	var itemId = $("#selectItems").val();
	if (!itemId) {
		itemId = 541;
	}
	var url = "/yztb/PDFViewer.jsp?certCode="+certCode+"&sfid="+sfid + "&itemId=" + itemId + "&sfName="
	window.open(url, "newwindow", "'width="+1000+",height="+800+", toolbar=no, menubar=no, scrollbars=no, resizable=yes, location=no, status=no");
}

function guid() {
	    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
	        var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
	        return v.toString(16);
	    });
}
function generatePDF1(certCode,sfid){
	var itemId = $("#selectItems").val();
	if (!itemId) {
		itemId = 541;
	}
	var uid = guid();
	//var pdfurl = "../fileDownloadAction.action?certCode="+certCode+"&sfId="+sfid+"&itemId=" + itemId + "&busiCode=" + uid+ "&sfName=" + "";
	var pdfurl = "../createDownloadReturnFile.action?certCode="+certCode+"&sfId="+sfid;
	var $a = document.createElement('a');
    $a.setAttribute("href", pdfurl);
    $a.setAttribute("download", "");
    var evObj = document.createEvent('MouseEvents');
    evObj.initMouseEvent( 'click', true, true, window, 0, 0, 0, 0, 0, false, false, true, false, 0, null);
    $a.dispatchEvent(evObj);
	
	//window.open(pdfurl);
}

function generateQyPDF(){
	var itemId = $("#selectItems").val(); 
	if (!itemId) {
		itemId = 541;
	}
	var url = "/yztb/PDFViewerEnter.jsp?certCode="+certCode+"&uniscid="+uniscid + "&itemId=" + itemId + "&entName=" + entName;
	window.open(url, "newwindow", "'width="+1000+",height="+800+", toolbar=no, menubar=no, scrollbars=no, resizable=yes, location=no, status=no");
}

/***
 * 获取当前日期时间
 */
function getNowFormatDate() {
    var date = new Date();
    var seperator1 = "-";
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    
    var hours=date.getHours();
    var minutes=date.getMinutes();
    var seconds=date.getSeconds();
    
    var strDate = date.getDate();
    if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    
    if (hours >= 0 && hours <= 9) {
    	hours = "0" + hours;
    }
    if (minutes >= 0 && minutes <= 9) {
    	minutes = "0" + minutes;
    }
    if (seconds >= 0 && seconds <= 9) {
    	seconds = "0" + seconds;
    }
    var currentdate = year + "-" + month + "-" + strDate+"	"+ hours+":"+ minutes+":"+ seconds;
    return currentdate;
}

/** 加载表单值(通用：[对象.字段/字段])(如果readonly或disabled不填充数据) **/
function loadFormAll(formId, data) {
	if (null == data || "" == data) {
		return;
	}
	$("#"+ formId + " input").each(function(index, n){
		var obj = $(n);
		var name = obj.attr("name");
		if (typeof(name) != "undefined" && (!$(obj).attr("readonly") && !$(obj).attr("disabled")) && $(obj).attr("type") != "checkbox") {
			if (name.indexOf(".") < 0) {
				obj.val(data[name]);
			} else {
				var startIndex = name.indexOf(".") + 1;
				var stopIndex = name.length;
				var newName = name.substring(startIndex,stopIndex);
				obj.val(data[newName]);
			}
		}
	});

	$("#"+ formId + " textarea").each(function(index, n){
		var obj = $(n);
		var name = obj.attr("name");
		if (typeof(name) != "undefined" && (!$(obj).attr("readonly") && !$(obj).attr("disabled"))) {
			if (name.indexOf(".") < 0) {
				obj.val(data[name]);
			} else {
				var startIndex = name.indexOf(".") + 1;
				var stopIndex = name.length;
				var newName = name.substring(startIndex,stopIndex);
				obj.val(data[newName]);
			}
		}
	});

	$("#"+ formId + " select").each(function(index, n){
		var obj = $(n);
		var name = obj.attr("name");
		if (typeof(name) != "undefined" && (!$(obj).attr("readonly") && !$(obj).attr("disabled"))) {
			if (name.indexOf(".") < 0) {
				obj.val(data[name]).change();
			} else {
				var startIndex = name.indexOf(".") + 1;
				var stopIndex = name.length;
				var newName = name.substring(startIndex,stopIndex);
				obj.val(data[newName]).change();
			}
		}
	});
}

function dateFormatter(val) {
	if(val) {
		return val.replace("T"," ");
	} else {
		return "-";
	}
}